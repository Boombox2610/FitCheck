<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fashion Preferences</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            background: linear-gradient(180deg, #000000, #2b00ff);
            color: white;
            font-family: 'Arial', sans-serif;
        }

        .glass-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 2rem;
            transition: box-shadow 0.3s ease-in-out;
        }
        .glass-container:hover {
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.4);
            
        }

        button {
            background-color: #7357ff;
            color: white;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #fcacff;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">
    <!-------------- SIGN UP ------------------------->
    <div class="glass-container w-full max-w-md" id="signupContainer">
        <h2 class="text-2xl font-semibold text-center mb-4">Sign Up</h2>
        <form id="signupForm" class="space-y-4">
            <div class="flex flex-col-reverse ">
                <input
                  placeholder="Email Address"
                  class="relative bg-transparent h-12 px-4 py-1 text-xs border-0 rounded-lg shadow-xl outline-none peer ring ring-base-200 duration-500 focus:ring-2 focus:border-base-100 placeholder:duration-500 placeholder:absolute focus:placeholder:pt-10 shadow-base-400/10 focus:shadow-none focus:rounded-md focus:ring-blue-600 placeholder:text-base-500"
                  type="text" name="email" required
                  pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                />
                <span
                  class="mb-2 text-xs opacity-0 duration-500 peer-focus:opacity-100 text-base-500 -translate-y-1 peer-focus:translate-y-0"
                  >Email Address</span
                >
            </div>
            <div class="flex flex-col-reverse ">
                <input
                  placeholder="Password"
                  class="relative bg-transparent h-12 px-4 py-1 text-xs border-0 rounded-lg shadow-xl outline-none peer ring ring-base-200 duration-500 focus:ring-2 focus:border-base-100 placeholder:duration-500 placeholder:absolute focus:placeholder:pt-10 shadow-base-400/10 focus:shadow-none focus:rounded-md focus:ring-blue-600 placeholder:text-base-500"
                  type="password" name="password" required minlength="6"
                />
                <span
                  class="mb-2 text-xs opacity-0 duration-500 peer-focus:opacity-100 text-base-500 -translate-y-1 peer-focus:translate-y-0"
                  >Password</span
                >
            </div>

            <button type="submit" class="w-full p-2 rounded">Sign Up</button>
        </form>
        <button id="switchToLogin" class="w-full p-2 rounded mt-4">Already have an account? Log In</button>

        
    </div>

    <!-------------- LOG IN ------------------------->
    <div class="glass-container w-full max-w-md hidden" id="loginContainer">
        <h2 class="text-2xl font-semibold text-center mb-4">Log In</h2>
        <form id="loginForm" class="space-y-4">
            <div class="flex flex-col-reverse ">
                <input
                  placeholder="Email Address"
                  class="relative bg-transparent h-12 px-4 py-1 text-xs border-0 rounded-lg shadow-xl outline-none peer ring ring-base-200 duration-500 focus:ring-2 focus:border-base-100 placeholder:duration-500 placeholder:absolute focus:placeholder:pt-10 shadow-base-400/10 focus:shadow-none focus:rounded-md focus:ring-blue-600 placeholder:text-base-500"
                  type="text" name="email" required
                  pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                />
                <span
                  class="mb-2 text-xs opacity-0 duration-500 peer-focus:opacity-100 text-base-500 -translate-y-1 peer-focus:translate-y-0"
                  >Email Address</span
                >
            </div>

            
            <div class="flex flex-col-reverse ">
                <input
                  placeholder="Password"
                  class="relative bg-transparent h-12 px-4 py-1 text-xs border-0 rounded-lg shadow-xl outline-none peer ring ring-base-200 duration-500 focus:ring-2 focus:border-base-100 placeholder:duration-500 placeholder:absolute focus:placeholder:pt-10 shadow-base-400/10 focus:shadow-none focus:rounded-md focus:ring-blue-600 placeholder:text-base-500"
                  type="password" name="password" required minlength="6"
                />
                <span
                  class="mb-2 text-xs opacity-0 duration-500 peer-focus:opacity-100 text-base-500 -translate-y-1 peer-focus:translate-y-0"
                  >Password</span
                >
            </div>
            <button type="submit" class="w-full p-2 rounded">Log In</button>
        </form>
        <button id="switchToSignup" class="w-full p-2 rounded mt-4">Don't have an account? Sign Up</button>
    </div>

    <!-------------- PREFERENCES ------------------------->
    <div class="glass-container w-full max-w-4xl hidden flex flex-col" id="preferencesContainer">
        <!-- Preferences Form -->
        <div class="w-full">
            <h2 class="text-2xl font-semibold text-center mb-4">Tell Us About Your Style</h2>
            <form id="preferencesForm" class="space-y-4">
                <div class="flex flex-col-reverse">
                    <input
                      placeholder="Preferred Colors (e.g., Black, Blue)"
                      class="relative bg-transparent h-12 px-4 py-1 text-xs border-0 rounded-lg shadow-xl outline-none peer ring ring-base-200 duration-500 focus:ring-2 focus:border-base-100 placeholder:duration-500 placeholder:absolute focus:placeholder:pt-10 shadow-base-400/10 focus:shadow-none focus:rounded-md focus:ring-blue-600 placeholder:text-base-500"
                      type="text" name="color" required
                    />
                    <span
                      class="mb-2 text-xs opacity-0 duration-500 peer-focus:opacity-100 text-base-500 -translate-y-1 peer-focus:translate-y-0"
                      >Preferred Colors</span>
                </div>
                <div class="flex flex-col-reverse">
                    <input
                      placeholder="Favorite Fabric (e.g., Cotton, Denim)"
                      class="relative bg-transparent h-12 px-4 py-1 text-xs border-0 rounded-lg shadow-xl outline-none peer ring ring-base-200 duration-500 focus:ring-2 focus:border-base-100 placeholder:duration-500 placeholder:absolute focus:placeholder:pt-10 shadow-base-400/10 focus:shadow-none focus:rounded-md focus:ring-blue-600 placeholder:text-base-500"
                      type="text" name="fabric" required
                    />
                    <span
                      class="mb-2 text-xs opacity-0 duration-500 peer-focus:opacity-100 text-base-500 -translate-y-1 peer-focus:translate-y-0"
                      >Favorite Fabric</span>
                </div>
                <div class="flex flex-col-reverse">
                    <input
                      placeholder="Fit & Style (e.g., Slim, Casual)"
                      class="relative bg-transparent h-12 px-4 py-1 text-xs border-0 rounded-lg shadow-xl outline-none peer ring ring-base-200 duration-500 focus:ring-2 focus:border-base-100 placeholder:duration-500 placeholder:absolute focus:placeholder:pt-10 shadow-base-400/10 focus:shadow-none focus:rounded-md focus:ring-blue-600 placeholder:text-base-500"
                      type="text" name="fit_style" required
                    />
                    <span
                      class="mb-2 text-xs opacity-0 duration-500 peer-focus:opacity-100 text-base-500 -translate-y-1 peer-focus:translate-y-0"
                      >Fit & Style</span>
                </div>
                <div class="flex flex-col-reverse">
                    <input
                      placeholder="Personality Type (e.g., Minimalist, Bold, Classic)"
                      class="relative bg-transparent h-12 px-4 py-1 text-xs border-0 rounded-lg shadow-xl outline-none peer ring ring-base-200 duration-500 focus:ring-2 focus:border-base-100 placeholder:duration-500 placeholder:absolute focus:placeholder:pt-10 shadow-base-400/10 focus:shadow-none focus:rounded-md focus:ring-blue-600 placeholder:text-base-500"
                      type="text" name="personality" required
                    />
                    <span
                      class="mb-2 text-xs opacity-0 duration-500 peer-focus:opacity-100 text-base-500 -translate-y-1 peer-focus:translate-y-0"
                      >Personality Type</span>
                </div>
                <div class="flex flex-col-reverse">
                    <input
                      placeholder="Accessories (e.g., Watch, Bracelet)"
                      class="relative bg-transparent h-12 px-4 py-1 text-xs border-0 rounded-lg shadow-xl outline-none peer ring ring-base-200 duration-500 focus:ring-2 focus:border-base-100 placeholder:duration-500 placeholder:absolute focus:placeholder:pt-10 shadow-base-400/10 focus:shadow-none focus:rounded-md focus:ring-blue-600 placeholder:text-base-500"
                      type="text" name="accessory" required
                    />
                    <span
                      class="mb-2 text-xs opacity-0 duration-500 peer-focus:opacity-100 text-base-500 -translate-y-1 peer-focus:translate-y-0"
                      >Accessories</span>
                </div>
                <div class="flex flex-col-reverse">
                    <input
                      placeholder="Preferred Occasions (e.g., Casual Outing, Formal)"
                      class="relative bg-transparent h-12 px-4 py-1 text-xs border-0 rounded-lg shadow-xl outline-none peer ring ring-base-200 duration-500 focus:ring-2 focus:border-base-100 placeholder:duration-500 placeholder:absolute focus:placeholder:pt-10 shadow-base-400/10 focus:shadow-none focus:rounded-md focus:ring-blue-600 placeholder:text-base-500"
                      type="text" name="occasion" required
                    />
                    <span
                      class="mb-2 text-xs opacity-0 duration-500 peer-focus:opacity-100 text-base-500 -translate-y-1 peer-focus:translate-y-0"
                      >Preferred Occasions</span>
                </div>
                <div class="flex flex-col-reverse">
                    <input
                    placeholder="Comfort Level (e.g., Low, Medium, High)"
                    class="relative bg-transparent h-12 px-4 py-1 text-xs border-0 rounded-lg shadow-xl outline-none peer ring ring-base-200 duration-500 focus:ring-2 focus:border-base-100 placeholder:duration-500 placeholder:absolute focus:placeholder:pt-10 shadow-base-400/10 focus:shadow-none focus:rounded-md focus:ring-blue-600 placeholder:text-base-500"
                    type="text" name="comfort_level" required
                    />

                    <span
                      class="mb-2 text-xs opacity-0 duration-500 peer-focus:opacity-100 text-base-500 -translate-y-1 peer-focus:translate-y-0"
                      >Comfort Level</span>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" name="practicality" class="mr-2">
                    <label class="text-sm text-white">Prioritize Practicality?</label>
                </div>
                <button type="submit" class="w-full p-2 rounded">Submit</button>
            </form>
            <button id="generateOutfitButton" class="w-full p-2 rounded mt-4">Generate Outfit</button>
        </div>
    
        <!-- Generated Outfit -->
        <div class="w-full flex items-center justify-center mt-6" id="generatedOutfitContainer">
            <!-- The generated image will dynamically appear here -->
        </div>
        <button id="signOutButton" class="w-full bg-red-500 text-white p-2 rounded hover:bg-red-600 mt-4">Sign Out</button>
    </div>

    <script>
        function toggleForms() {
            const token = localStorage.getItem("access_token");
            const signupContainer = document.getElementById("signupContainer");
            const loginContainer = document.getElementById("loginContainer");
            const preferencesContainer = document.getElementById("preferencesContainer");

            if (token) {
                signupContainer.style.display = "none";
                loginContainer.style.display = "none";
                preferencesContainer.style.display = "block";
            } else {
                signupContainer.style.display = "block";
                loginContainer.style.display = "none";
                preferencesContainer.style.display = "none";
            }
        }

        // Switch to Login form
        document.getElementById("switchToLogin").addEventListener("click", function () {
            document.getElementById("signupContainer").style.display = "none";
            document.getElementById("loginContainer").style.display = "block";
        });

        // Switch to Signup form
        document.getElementById("switchToSignup").addEventListener("click", function () {
            document.getElementById("loginContainer").style.display = "none";
            document.getElementById("signupContainer").style.display = "block";
        });

        // Handle Signup
        document.getElementById("signupForm").addEventListener("submit", function (event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData.entries());

            fetch("/signup", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data),
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message || data.error);
                if (!data.error) {
                    document.getElementById("signupContainer").style.display = "none";
                    document.getElementById("loginContainer").style.display = "block";
                }
            })
            .catch(error => console.error("Error:", error));
        });

        // Handle Login
        document.getElementById("loginForm").addEventListener("submit", function (event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData.entries());

            fetch("/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data),
            })
            .then(response => response.json())
            .then(data => {
                if (data.access_token) {
                    localStorage.setItem("access_token", data.access_token);
                    alert("Login successful!");
                    toggleForms();
                } else {
                    alert(data.error);
                }
            })
            .catch(error => console.error("Error:", error));
        });

        // Handle Preferences Submission
        document.getElementById("preferencesForm").addEventListener("submit", function (event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData.entries());
            data.practicality = formData.has("practicality");

            const token = localStorage.getItem("access_token");
            if (!token) {
                alert("Please log in first!");
                return;
            }

            fetch("/submit-preferences", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${token}`
                },
                body: JSON.stringify(data),
            })
            .then(response => response.json())
            .then(data => alert(data.message || data.error))
            .catch(error => console.error("Error:", error));
        });

        // Handle Sign Out
        document.getElementById("signOutButton").addEventListener("click", function () {
            localStorage.removeItem("access_token"); // Clear the token
            alert("You have been signed out.");
            toggleForms(); // Redirect to signup form
        });

    document.getElementById("generateOutfitButton").addEventListener("click", function () {
        const token = localStorage.getItem("access_token");
        if (!token) {
            alert("Please log in first!");
            return;
        }

        fetch("/generate-outfit", {
            method: "POST",
            headers: {
                "Authorization": `Bearer ${token}`
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert(data.error);
            } else {
                // Dynamically insert the generated image and prompt into the container
                const generatedOutfitContainer = document.getElementById("generatedOutfitContainer");
                generatedOutfitContainer.innerHTML = `
                    <div class="p-4 rounded-lg shadow-lg">
                        <h3 class="text-xl font-semibold text-center mb-4">Generated Outfit</h3>
                        <img src="${data.image}" alt="Generated Outfit" class="w-full rounded-lg shadow-md">
                        <p class="text-white-700 mt-4">${data.prompt}</p>
                        <div class="flex justify-center mt-4">
                            <button id="likeButton" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 mr-2">Like</button>
                            <button id="dislikeButton" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Dislike</button>
                        </div>
                    </div>
                `;

                // Add event listeners for like and dislike buttons
                document.getElementById("likeButton").addEventListener("click", function () {
                    updateLikeStatus(data.outfit_id, true, token); // Pass `outfit_id` and `liked`
                });

                document.getElementById("dislikeButton").addEventListener("click", function () {
                    updateLikeStatus(data.outfit_id, false, token); // Pass `outfit_id` and `liked`
                });
            }
        })
        .catch(error => console.error("Error:", error));
    });

        // Function to update like status
        function updateLikeStatus(outfitId, liked, token) {
            fetch("/update-like-status", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${token}`
                },
                body: JSON.stringify({ outfit_id: outfitId, liked: liked }) // Ensure both `outfit_id` and `liked` are sent
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                } else {
                    alert(liked ? "You liked this outfit!" : "You disliked this outfit!");
                }
            })
            .catch(error => console.error("Error:", error));
        }

        // Call toggleForms on page load
        document.addEventListener("DOMContentLoaded", toggleForms);
    </script>
</body>
</html>